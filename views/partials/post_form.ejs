<!--  Drop-down to Create a Post  -->
<button type="button" class="jm-button" onclick="toggleElement('postCreationForm')">Create Post
</button>

<!-- Posts Container -->
<div id="posts">
    <!-- Multimedia Post Form -->
    <div style="display:none;" id="postCreationForm" class="border border-primary">
        <form id="postForm" enctype="multipart/form-data">
            <textarea name="content" rows="4" cols="50" placeholder="Write something or share a clip..."></textarea><br>
            <input type="file" name="media" id="postFileInput" accept="video/*,audio/*" style="display: none;"
                   onchange="document.getElementById('postFileName').textContent = this.files[0] ? this.files[0].name : 'No file chosen';">

            <button type="button" id="postFileButton" class="btn btn-link btn-lg" onclick="document.getElementById('postFileInput').click();">
                Choose File
            </button>
            <span id="postFileName">No file chosen</span><br>

            <label for="instrument">Instrument:</label>
            <input list="instrumentList" name="instrument">
            <br>
            <label for="genre">Genre:</label>
            <input list="genreList" name="genre">
            <br>
            <label for="skillLevel">Skill Level:</label>
            <select class="form-select" name="skillLevel">
                <option value="" selected>Select skill level</option>
                <option value="beginner">Beginner</option>
                <option value="intermediate">Intermediate</option>
                <option value="advanced">Advanced</option>
            </select>
            <button type="submit" class="btn btn-link btn-lg" data-mdb-button-init data-mdb-ripple-init data-mdb-ripple-color="dark">
                Post your content now!
            </button>
        </form>
    </div>

    <datalist id="instrumentList">
        <option value="Guitar">
        <option value="Piano">
        <option value="Violin">
        <!-- Add more instrument options as needed -->
    </datalist>

    <datalist id="genreList">
        <option value="Rock">
        <option value="Jazz">
        <option value="Classical">
        <!-- Add more genre options as needed -->
    </datalist>
</div>

<script>
document.getElementById('postFileButton').addEventListener('click', function() {
    document.getElementById('postFileInput').click();
});

document.getElementById('postFileInput').addEventListener('change', function() {
    var fileLabel = document.getElementById('postFileName');
    var file = this.files[0];
    fileLabel.textContent = file ? file.name : 'No file chosen';
    console.log("File selected:", file ? file.name : 'No file chosen');
});

document.getElementById('postForm').addEventListener('submit', function(event) {
    event.preventDefault();
    var formData = new FormData(this);

    fetch('/post', {
        method: 'POST',
        body: formData
    })
    .then(response => {
        if (response.ok) return response.json();
        else throw new Error('Failed to fetch');
    })
    .then(data => {
        console.log("Post success:", data);
        if (data.content) {  // Check if content is defined
            var newPostHTML = `<div>New Post: ${data.content}</div>`;
            document.getElementById('posts').innerHTML += newPostHTML;
        }
        document.getElementById('postForm').reset(); // Reset the form after submission
        document.getElementById('postCreationForm').style.display = 'none'; // Hide the form again
    })
    .catch(error => console.error('Error:', error));
});

document.querySelector('#postForm textarea').addEventListener('keydown', function(event) {
    if (event.key === "Enter" && !event.shiftKey) {
        event.preventDefault(); // Prevent default action (do not insert a newline)
        document.getElementById('postForm').dispatchEvent(new Event('submit', { cancelable: true })); // Trigger form submission
    }
});

</script>
