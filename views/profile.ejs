  <%- include('partials/header', {user: loggedIn}) %>
  <body>
    <h1><%= user.nickname %>'s Profile</h1>
    <p> <%= user.description %></p>
    <button type="button" data-mdb-button-init data-mdb-ripple-init class="btn btn-link btn-lg" data-mdb-ripple-color="dark">
      <i class="fas fa-share me-2"></i>Edit Self-Bio
    </button>

    <!-- Post Form, hidden initially -->
    <div style="display:none;" id="postCreationForm">
      <form id="postForm" enctype="multipart/form-data" onsubmit="return submitPost();">
        <textarea name="content" rows="4" cols="50" placeholder="Share something..." onkeydown="handleEnter(event)"></textarea><br>
        <input type="file" name="media" accept="audio/*,video/*"><br>
        <button type="button" onclick="submitPost()">Post</button>
      </form>
    </div>

    <button type="button" onclick="document.getElementById('postCreationForm').style.display='block';">Create Post</button>

    <p>Contact me for gigs at <%= user.email %></p>
    <div id="posts">
      <% posts.forEach(function(post) { %>
        <div class="post" id="post-<%= post.id %>">
          <p>User: <%= post.nickname %>, Content: "<%= post.content %>", Posted at (<%= post.timestamp %>)</p>
          <button onclick="deletePost('<%= post.id %>')">Delete Post</button>
        </div>
      <% }); %>
    </div>

    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script>
    function submitPost() {
      var formData = new FormData(document.getElementById('postForm'));
      $.ajax({
        url: '/create-post',
        type: 'POST',
        data: formData,
        success: function(data) {
          var newPost = '<div class="post" id="post-' + data.id + '">' +
                        '<p>User: <%= user.nickname %>, Content: "' + data.content + '", Posted at (' + new Date(data.timestamp).toLocaleString() + ')</p>' +
                        '<button onclick="deletePost(\'' + data.id + '\')">Delete Post</button>' +
                        '</div>';
          $('#posts').prepend(newPost);
          document.getElementById('postForm').reset(); // Reset the form
          document.getElementById('postCreationForm').style.display='none'; // Hide the form again
        },
        cache: false,
        contentType: false,
        processData: false,
        error: function(xhr, status, error) {
          alert("Error: " + xhr.responseText);
        }
      });
      return false;  // Prevent traditional form submission
    }

    function deletePost(postId) {
      if (confirm('Are you sure you want to delete this post?')) {
          $.ajax({
              url: '/delete-post/' + postId,
              type: 'DELETE',
              success: function(result) {
                  $('#post-' + postId).remove();
              },
              error: function(xhr, status, error) {
                  alert("Error deleting post: " + xhr.responseText);
              }
          });
      }
    }

    function handleEnter(e) {
      if (e.keyCode === 13 && !e.shiftKey) { // Check if Enter is pressed without the Shift key
        e.preventDefault(); // Prevent default action
        submitPost(); // Call submitPost function
      }
    }
    </script>
  </body>
  <footer>
    <%- include('partials/footer') %>
  </footer>
  </html>

